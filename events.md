# 🎪 이벤트 시스템

DonationAPI의 핵심 기능인 이벤트 시스템을 상세히 설명합니다.

## 📋 목차

- [이벤트 개요](#-이벤트-개요)
- [이벤트 종류](#-이벤트-종류)
- [대상 시스템](#-대상-시스템)
- [우선순위 시스템](#-우선순위-시스템)
- [고급 기능](#-고급-기능)
- [실제 예제](#-실제-예제)

## 🎯 이벤트 개요

### 이벤트란?
후원이 들어왔을 때 마인크래프트 서버에서 자동으로 실행되는 액션들입니다.

### 이벤트 구성 요소
```
후원 금액 → 이벤트 트리거 → 액션 실행
```

### 지원하는 금액 타입
- **정확한 금액**: `1000` (정확히 1000원)
- **범위 금액**: `1000~5000` (1000원~5000원 사이)
- **무한 금액**: `무한` (모든 금액에서 실행되는 기본 이벤트)

### 이벤트 적용 범위
- **공통**: 모든 스트리머에게 적용
- **플랫폼별**: 치지직/숲 플랫폼 전체
- **개별**: 특정 스트리머만

## 🎨 이벤트 종류

### 1. 📝 메시지 이벤트

채팅, 타이틀, 액션바 등 다양한 형태의 메시지를 출력합니다.

#### 메시지 타입

**채팅 메시지 (chat:)**
```bash
# 기본 채팅 메시지
/후원관리 이벤트설정 공통 1000 전체 메시지 &a%donator_name%님 감사합니다!

# 명시적 채팅 메시지
/후원관리 이벤트설정 공통 1000 전체 메시지 chat:&b후원 감사드립니다!
```

**타이틀 메시지 (title:)**
```bash
# 타이틀만
/후원관리 이벤트설정 공통 5000 스트리머 메시지 title:&6후원 감사합니다!

# 타이틀 + 서브타이틀
/후원관리 이벤트설정 공통 5000 스트리머 메시지 title:&6감사합니다!\nsubtitle:&e%donator_name%님
```

**서브타이틀 메시지 (subtitle:)**
```bash
/후원관리 이벤트설정 공통 2000 스트리머 메시지 subtitle:&e%amount%원 후원
```

**액션바 메시지 (actionbar:)**
```bash
/후원관리 이벤트설정 공통 1000 전체 메시지 actionbar:&c후원: %amount%원
```

**복합 메시지**
```bash
# 여러 타입 동시 사용
/후원관리 이벤트설정 공통 10000 전체 메시지 chat:&a채팅 메시지\ntitle:&6타이틀 메시지\nactionbar:&c%amount%원
```

#### 색상 코드 지원

**기본 색상 코드**
- `&0` ~ `&f` : 기본 16색상
- `&l` : 굵게, `&o` : 기울임, `&n` : 밑줄
- `&m` : 취소선, `&k` : 랜덤문자

**Hex 색상 코드**
```bash
# Hex 색상 사용
/후원관리 이벤트설정 공통 1000 전체 메시지 &#FF5555후원 감사합니다!

# 그라데이션 효과 (MiniMessage)
/후원관리 이벤트설정 공통 5000 전체 메시지 <gradient:red:blue>그라데이션 메시지</gradient>
```

#### 멀티라인 메시지
```bash
# \n을 사용한 줄바꿈
/후원관리 이벤트설정 공통 3000 전체 메시지 &a첫 번째 줄\n&b두 번째 줄\n&c세 번째 줄
```

### 2. 🎁 아이템 이벤트

플레이어에게 아이템을 지급합니다.

#### 설정 방법
```bash
# GUI 열기
/후원관리 이벤트설정 공통 1000 스트리머 아이템
```

#### GUI 사용법
1. **명령어 실행** → GUI 창 열림
2. **아이템 배치** → 인벤토리에서 원하는 아이템을 GUI로 드래그
3. **수량 설정** → 아이템 수량 조정
4. **저장** → 저장 버튼 클릭

#### 아이템 저장 방식
- Base64 인코딩으로 저장
- 인챈트, 이름, 설명 모두 보존
- 수량 제한 없음

#### 예시 아이템들
```yaml
# 다이아몬드 64개
Diamond x64

# 인챈트된 검
Diamond Sword
- Sharpness V
- Unbreaking III

# 커스텀 이름/설명 아이템
Golden Apple
- Name: "&6황금 사과"
- Lore: 
  - "&7후원 감사 선물"
  - "&e%donator_name%님이 주신 선물"
```

### 3. ⚡ 명령어 이벤트

플레이어나 콘솔에서 명령어를 실행합니다.

#### 실행 타입

**플레이어 명령어 (PLAYER:)**
```bash
# 기본 형식
/후원관리 이벤트설정 공통 1000 스트리머 명령어 PLAYER:/heal

# 복수 대상 (전체 선택 시)
/후원관리 이벤트설정 공통 1000 전체 명령어 PLAYER:/tp ~ ~100 ~
# → 모든 온라인 플레이어가 각각 실행
```

**콘솔 명령어 (CONSOLE:)**
```bash
# 기본 형식 (권한 제한 없음)
/후원관리 이벤트설정 공통 1000 스트리머 명령어 CONSOLE:/give %player% diamond 1

# 전체 공지
/후원관리 이벤트설정 공통 5000 전체 명령어 CONSOLE:/say %donator_name%님이 %amount%원을 후원하셨습니다!
```

#### 멀티 명령어
```bash
# 여러 명령어 실행 (\n으로 구분)
/후원관리 이벤트설정 공통 5000 스트리머 명령어 PLAYER:/heal\nPLAYER:/feed\nCONSOLE:/give %player% diamond 1
```

#### 명령어 예시들
```bash
# 순간이동
PLAYER:/tp ~ ~100 ~

# 아이템 지급  
CONSOLE:/give %player% diamond 64

# 이펙트 부여
CONSOLE:/effect give %player% speed 30 2

# 경험치 지급
CONSOLE:/xp add %player% 1000

# 돈 지급 (Vault 필요)
CONSOLE:/eco give %player% 10000

# 칭호 부여 (ChatColorPlus 등)
CONSOLE:/title set %player% &6[후원왕]
```

### 4. 🔧 애드온 이벤트

외부 애드온과 연동하는 고급 이벤트입니다.

#### 기본 사용법
```bash
# 기본 애드온 실행
/후원관리 이벤트설정 공통 1000 스트리머 애드온 launch_to_sky
```

#### 변수 전달
```bash
# key=value 형식
/후원관리 이벤트설정 공통 5000 스트리머 애드온 custom_effect power=5 duration=10

# key:value 형식
/후원관리 이벤트설정 공통 3000 스트리머 애드온 particle_effect type:heart count:50

# 단일 키 형식
/후원관리 이벤트설정 공통 1000 전체 애드온 sound_effect loud epic
```

#### 애드온 개발 예시
```java
// 애드온 등록 (플러그인에서)
DonationAPI.registerAddon("custom_effect", (player, data, variables) -> {
    int power = Integer.parseInt(variables.getOrDefault("power", "1"));
    int duration = Integer.parseInt(variables.getOrDefault("duration", "10"));
    
    // 커스텀 이펙트 실행
    player.addPotionEffect(new PotionEffect(PotionEffectType.STRENGTH, duration * 20, power - 1));
});
```

## 🎯 대상 시스템

### 대상 타입

**전체 (ALL)**
- 서버의 모든 온라인 플레이어
- Velocity 네트워크: 전체 네트워크의 모든 플레이어
- 브로드캐스트 메시지에 적합
- 서버 이벤트에 활용

**스트리머 (STREAMER)**  
- 후원을 받은 스트리머만
- 각 서버에서 개별 처리 (Velocity 네트워크 포함)
- 개인적인 보상에 적합
- 스트리머가 오프라인이면 실행되지 않음

**특정 플레이어**
- 지정된 특정 플레이어만
- 특별한 이벤트에 활용
- 해당 플레이어가 오프라인이면 실행되지 않음

### 대상별 이벤트 실행 방식

#### 메시지 이벤트
```bash
# 전체 대상 - 모든 플레이어에게 채팅 메시지
전체: [후원] steve님이 1000원을 후원하셨습니다!

# 스트리머 대상 - 스트리머에게만 타이틀 + 채팅
스트리머 채팅: 1000원 후원 감사합니다!
스트리머 타이틀: 감사합니다!
```

#### 아이템 이벤트
```bash
# 전체 대상 - 모든 온라인 플레이어가 아이템 받음
단일 서버: 온라인 5명 → 각자 다이아몬드 1개씩
Velocity 네트워크: 전체 네트워크 플레이어 → 우편함으로 전달

# 스트리머 대상 - 스트리머만 받음  
스트리머: steve만 → 다이아몬드 1개 (해당 서버에서만)
```

#### 명령어 이벤트
```bash
# 전체 PLAYER 명령어 - 각자 실행
PLAYER:/heal → 온라인 5명이 각자 /heal 실행

# 전체 CONSOLE 명령어 - 콘솔에서 1번만 실행
CONSOLE:/say 공지 → 콘솔에서 1번 실행

# 스트리머 PLAYER 명령어 - 스트리머만 실행
PLAYER:/tp ~ ~100 ~ → steve만 실행

# 스트리머 CONSOLE 명령어 - 스트리머 대상으로 콘솔 실행
CONSOLE:/give %player% diamond 1 → 콘솔에서 steve에게 다이아몬드 지급
```

## 📊 우선순위 시스템

이벤트는 다음 순서로 검색되고 실행됩니다:

### 1단계: 정확한 금액 매칭
```
후원 금액: 1000원
검색 순서:
1. steve의 1000원 이벤트 (개별)
2. 치지직의 1000원 이벤트 (플랫폼)  
3. 공통 1000원 이벤트 (공통)
```

### 2단계: 범위 매칭
```
후원 금액: 3000원
범위 이벤트 검색:
1. steve의 1000~5000원 이벤트 (개별)
2. 치지직의 2000~4000원 이벤트 (플랫폼)
3. 공통 1000~10000원 이벤트 (공통)

우선순위: 더 좁은 범위가 우선
→ 2000~4000원 (범위: 2000) > 1000~5000원 (범위: 4000)
```

### 3단계: 무한 이벤트
```
위의 모든 검색에서 결과가 없으면:
1. steve의 무한 이벤트 (개별)
2. 치지직의 무한 이벤트 (플랫폼)
3. 공통 무한 이벤트 (공통)
```

### 우선순위 예시
```bash
# 설정된 이벤트들
공통 1000원: "공통 천원 이벤트"
공통 500~1500원: "공통 범위 이벤트"  
steve 1000원: "steve 전용 이벤트"
steve 무한: "steve 기본 이벤트"

# 1000원 후원 시 실행 순서
1. steve 1000원 이벤트 실행 (개별 정확 매칭)
2. 다른 이벤트들은 실행되지 않음

# 2000원 후원 시 실행 순서  
1. steve 2000원 이벤트 확인 → 없음
2. 공통 2000원 이벤트 확인 → 없음
3. steve 범위 이벤트 확인 → 없음
4. 공통 500~1500원 범위 확인 → 2000원은 범위 밖
5. steve 무한 이벤트 실행

# 1200원 후원 시 실행 순서
1. steve 1200원 이벤트 확인 → 없음  
2. 공통 1200원 이벤트 확인 → 없음
3. steve 범위 이벤트 확인 → 없음
4. 공통 500~1500원 범위 확인 → 1200원 포함! 실행
```

## 🌟 고급 기능

### 이벤트 실행 순서
동일한 금액에 여러 이벤트가 설정된 경우:

1. **메시지 이벤트** 먼저 실행
2. **아이템 이벤트** 다음 실행
3. **명령어 이벤트** 마지막 실행

```bash
# 1000원에 설정된 이벤트들
메시지: "감사합니다!" → 먼저 출력
아이템: 다이아몬드 1개 → 그 다음 지급
명령어: /heal → 마지막 실행
```

### 조건부 실행
- **온라인 상태**: 오프라인 플레이어는 이벤트 받지 않음
- **권한 확인**: 명령어 실행 시 권한 확인 (PLAYER 명령어)
- **서버 상태**: 서버 렉 시 이벤트 지연 가능

### 오류 처리
```bash
# 오류 상황들
1. 스트리머 오프라인 → 이벤트 건너뜀
2. 잘못된 명령어 → 콘솔에 오류 로그
3. 가득찬 인벤토리 → 바닥에 아이템 드롭
4. 권한 없는 명령어 → 실행 실패 (로그 기록)
```

## 💡 실제 예제

### 기본 후원 이벤트 세트
```bash
# 1000원 - 기본 감사 메시지
/후원관리 이벤트설정 공통 1000 전체 메시지 &a%donator_name%님 1000원 후원 감사합니다!

# 5000원 - 감사 메시지 + 아이템
/후원관리 이벤트설정 공통 5000 전체 메시지 &6%donator_name%님 5000원 대후원 감사드립니다!
/후원관리 이벤트설정 공통 5000 스트리머 아이템
# GUI에서 황금사과 3개 설정

# 10000원 - 특별 이벤트
/후원관리 이벤트설정 공통 10000 전체 메시지 title:&6&l특별 후원!\nsubtitle:&e%donator_name%님 감사합니다!
/후원관리 이벤트설정 공통 10000 스트리머 명령어 PLAYER:/tp ~ ~100 ~
/후원관리 이벤트설정 공통 10000 전체 명령어 CONSOLE:/say %donator_name%님의 특별한 후원으로 모든 플레이어가 경험치를 받습니다!
/후원관리 이벤트설정 공통 10000 전체 명령어 CONSOLE:/xp add @a 1000
```

### 범위 이벤트 활용
```bash
# 소액 후원 (100~999원)
/후원관리 이벤트설정 공통 100~999 전체 메시지 &7%donator_name%님 소중한 후원 감사합니다!

# 중간 후원 (1000~4999원)  
/후원관리 이벤트설정 공통 1000~4999 전체 메시지 &a%donator_name%님 %amount%원 후원 감사합니다!
/후원관리 이벤트설정 공통 1000~4999 스트리머 명령어 PLAYER:/heal

# 대형 후원 (5000~19999원)
/후원관리 이벤트설정 공통 5000~19999 전체 메시지 title:&6대형 후원!\nsubtitle:&e%donator_name%님 %amount%원
/후원관리 이벤트설정 공통 5000~19999 스트리머 아이템
# GUI에서 다이아몬드 장비 세트

# 초대형 후원 (20000원 이상)
/후원관리 이벤트설정 공통 20000~99999 전체 메시지 chat:&4&l★ 초대형 후원 ★\nactionbar:&6%donator_name%님이 %amount%원을 후원하셨습니다!
/후원관리 이벤트설정 공통 20000~99999 전체 명령어 CONSOLE:/give @a diamond 1
```

### 플랫폼별 특화 이벤트
```bash
# 치지직 전용 이벤트
/후원관리 이벤트설정 치지직 1000 전체 메시지 &9[치지직] &a%donator_name%님 후원 감사합니다!

# 숲 전용 이벤트  
/후원관리 이벤트설정 숲 1000 전체 메시지 &6[숲] &a%donator_name%님 후원 감사합니다!
```

### 개별 스트리머 특별 이벤트
```bash
# steve만의 특별 이벤트
/후원관리 이벤트설정 steve 5000 스트리머 메시지 title:&cSteve 전용 이벤트!
/후원관리 이벤트설정 steve 5000 스트리머 명령어 CONSOLE:/give steve netherite_sword 1

# alex의 재미있는 이벤트
/후원관리 이벤트설정 alex 3000 스트리머 명령어 PLAYER:/tp @r ~ ~ ~
# 랜덤 플레이어에게 텔레포트
```

### 무한 이벤트 (기본 이벤트)
```bash
# 기본 감사 메시지 (모든 후원에 실행)
/후원관리 이벤트설정 공통 무한 전체 메시지 &7%donator_name%님 후원 감사드립니다!

# 스트리머 힐링 (모든 후원에 실행)
/후원관리 이벤트설정 공통 무한 스트리머 명령어 PLAYER:/heal
```

### 창의적인 이벤트 아이디어
```bash
# 날씨 변경
/후원관리 이벤트설정 공통 2000 전체 명령어 CONSOLE:/weather clear

# 시간 변경
/후원관리 이벤트설정 공통 3000 전체 명령어 CONSOLE:/time set day

# 폭죽 쇼
/후원관리 이벤트설정 공통 10000 스트리머 명령어 CONSOLE:/summon firework_rocket ~ ~5 ~ {LifeTime:20,FireworksItem:{id:firework_rocket,Count:1,tag:{Fireworks:{Explosions:[{Type:1,Colors:[I;16711680]}]}}}}

# 랜덤 몬스터 소환
/후원관리 이벤트설정 공통 5000 스트리머 명령어 CONSOLE:/summon zombie ~ ~ ~ {CustomName:"[{\"text\":\"%donator_name%의 좀비\",\"color\":\"red\"}]"}

# 특별한 칭호 부여 (7일간)
/후원관리 이벤트설정 공통 50000 스트리머 명령어 CONSOLE:/lp user %player% permission settemp donationapi.title.vip true 7d
```

---

**💡 Pro Tips:**
- 범위 이벤트를 활용하여 세세한 금액별 이벤트 설정 필요성을 줄이세요
- 무한 이벤트로 기본 감사 메시지를 설정하세요
- 플랫폼별 특화 이벤트로 각 플랫폼의 특색을 살리세요
- 명령어 이벤트 시 권한을 고려하여 CONSOLE/PLAYER를 선택하세요 